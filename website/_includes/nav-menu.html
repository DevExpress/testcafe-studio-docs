<nav class="doc-main-nav">
    <div class="doc-main-nav-content">
        {% for menuItem in site.data.nav-menu %}
        {% capture itemUrl %}{{ menuItem.url | remove: "README.md" | replace: ".md", ".html" }}{% endcapture %}
        <div class="accordion-item{% if menuItem.content %} expandable{% if page.url contains itemUrl %} expanded{% endif %}{% endif %}">
            <div class="title" data-url="{{ itemUrl | prepend: site.baseurl }}">
                {{ menuItem.name }}
            </div>
            {% if menuItem.content and page.url contains itemUrl%}
            <div class="item-panel">
                <nav class="nav-tree-view">
                    <div class="tree-view-content">
                        {% include tree-view.html content=menuItem.content level=0 %}
                    </div>
                </nav>
            </div>
            {% endif %}
        </div>
        <div class="splitter"></div>
        {% endfor %}
    </div>
</nav>

<script>
    var navBar = document.getElementsByClassName('doc-main-nav')[0];

    navBar.addEventListener('click', function (e) {
        var $target    = $(e.target);
        var $itemPanel = $target.closest('.item-panel');

        if ($itemPanel.length)
            return;

        var $item = $target.closest('.title');

        if (!$item.length)
            return;

        var $currentExpanded = $('.accordion-item.expandable.expanded');

        if (!$currentExpanded.length || $currentExpanded[0] !== $item[0])
            window.location.href = $item[0].dataset.url;
    });

    var treeView = document.getElementsByClassName('nav-tree-view')[0];

    if (treeView) {
        treeView.addEventListener('click', function (e) {
            var $target       = $(e.target);
            var $treeViewItem = $target.closest('.tree-view-item');

            if (!$treeViewItem.length)
                return;

            window.location.href = $treeViewItem[0].dataset.url;
        });
    }

</script>
